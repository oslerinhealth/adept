<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walking strides segmentation with adept • adept</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Walking strides segmentation with adept">
<meta property="og:description" content="adept">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adept</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adept-intro.html">Introduction to adept package</a>
    </li>
    <li>
      <a href="../articles/adept-strides-segmentation.html">Walking strides segmentation with adept</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/martakarass/adept/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="adept-strides-segmentation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Walking strides segmentation with adept</h1>
                        <h4 data-toc-skip class="author">Marta Karas</h4>
                        <h4 data-toc-skip class="author">Ciprian Crainiceanu</h4>
                        <h4 data-toc-skip class="author">Jacek Urbanek</h4>
            
            <h4 data-toc-skip class="date">2021-05-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/martakarass/adept/blob/master/vignettes/adept-strides-segmentation.Rmd" class="external-link"><code>vignettes/adept-strides-segmentation.Rmd</code></a></small>
      <div class="hidden name"><code>adept-strides-segmentation.Rmd</code></div>

    </div>

    
    
<p>This vignette provides an example of segmentation of walking strides (two consecutive steps) in sub-second accelerometry data with <code>adept</code> package. The exemplary dataset is a part of the <code>adeptdata</code> package. We demonstrate that ADEPT<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> can be used to perform automatic and precise walking stride segmentation from data collected during a combination of running, walking and resting exercises. We introduce how to segment data:</p>
<ol style="list-style-type: lower-roman">
<li>with the use of stride templates that were pre-computed based on data from an external study (attached to <code>adeptdata</code> package),</li>
<li>by deriving new stride templates in a semi-manual manner.</li>
</ol>
<p>See <a href="https://martakarass.github.io/adept/articles/adept-intro.html" class="external-link">Introduction to adept package</a><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> vignette for an introduction to the ADEPT and usage examples of the <code>segmentPattern</code> function which implements the ADEPT method.</p>
<div id="raw-accelerometry-data-sample" class="section level1">
<h1 class="hasAnchor">
<a href="#raw-accelerometry-data-sample" class="anchor" aria-hidden="true"></a>Raw accelerometry data sample</h1>
<p>The <code>adeptdata</code> package contains <code>acc_running</code> - a sample of raw accelerometry data collected during 25 minutes of an outdoor run. Data were collected at the sampling frequency of 100 Hz with two ActiGraph GT9X Link sensors located at the left hip and left ankle.</p>
<div id="running-trial" class="section level3">
<h3 class="hasAnchor">
<a href="#running-trial" class="anchor" aria-hidden="true"></a>Running trial</h3>
<p><em>mapmyrun</em> mobile tracking application (<a href="https://www.mapmyrun.com" class="external-link">link</a>) was used during 25 minutes of running (Patterson Park area, Baltimore, MD) to collect <code>acc_running</code> accelerometry data set. Based on the mobile app, the distance covered is approximately 3.35 km. A ground elevation plot generated by the mobile app presents signature trial characteristics (see figure below). The timestamp in <code>acc_running</code> dataset matches the mobile app up to ~1-minute.</p>
<p><img src="https://imgur.com/VcK6o7o.jpg" width="90%"><small><small><small> Screenshot taken from a personal profile of <em>mapmyrun</em> tracking application, accessed via <a href="https://www.mapmyrun.com" class="external-link uri">https://www.mapmyrun.com</a>. </small></small></small></p>
</div>
<div id="sensor-and-accelerometry-data" class="section level3">
<h3 class="hasAnchor">
<a href="#sensor-and-accelerometry-data" class="anchor" aria-hidden="true"></a>Sensor and accelerometry data</h3>
<p>Data were collected with two <a href="https://www.actigraphcorp.com/actigraph-link/" class="external-link">ActiGraph GT9X Link</a> physical activity monitors at the sampling frequency of 100 Hz. ActiGraph GT9X Link has 3-axis accelerometer collecting accelerometry data along three orthogonal axes. At a sampling frequency of 100 Hz, we collected 100 observations per second per axis (total of 300 observations per second).</p>
</div>
<div id="sensor-location" class="section level3">
<h3 class="hasAnchor">
<a href="#sensor-location" class="anchor" aria-hidden="true"></a>Sensor location</h3>
<p>First sensor (denoted as “left_ankle”) was attached to the outer side of the left shoe with a slide-on clip, just below the ankle. A second sensor (denoted as “left_hip”) was attached on the left side of the elastic belt located hip (see image below). Both devices remained stable during the run-trial.</p>
<p><img src="https://imgur.com/5Ji2hQF.jpg" width="45%"><img src="https://imgur.com/lTdCixX.jpg" width="45%"><small><small><small> Wearable accelerometer devices location during the experiment. The devices were still covered with a protective plastic foil. </small></small></small></p>
</div>
<div id="data-set-acc_running" class="section level3">
<h3 class="hasAnchor">
<a href="#data-set-acc_running" class="anchor" aria-hidden="true"></a>Data set <code>acc_running</code>
</h3>
<p>To access the <code>acc_running</code> data, load <code>adeptdata</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># devtools::install_github("martakarass/adept")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/martakarass/adept" class="external-link">adept</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">adeptdata</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits.secs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">acc_running</span><span class="op">)</span>
<span class="co">#&gt;     loc_id              date_time      x      y     z</span>
<span class="co">#&gt; 1 left_hip 2018-10-25 17:57:30.00 -0.199 -1.012 0.133</span>
<span class="co">#&gt; 2 left_hip 2018-10-25 17:57:30.00 -0.191 -1.027 0.133</span>
<span class="co">#&gt; 3 left_hip 2018-10-25 17:57:30.01 -0.191 -1.035 0.121</span>
<span class="co">#&gt; 4 left_hip 2018-10-25 17:57:30.02 -0.191 -1.027 0.109</span>
<span class="co">#&gt; 5 left_hip 2018-10-25 17:57:30.03 -0.191 -1.016 0.109</span>
<span class="co">#&gt; 6 left_hip 2018-10-25 17:57:30.04 -0.184 -1.012 0.121</span>
<span class="fu"><a href="http://lubridate.tidyverse.org/reference/tz.html" class="external-link">tz</a></span><span class="op">(</span><span class="va">acc_running</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span>
<span class="co">#&gt; [1] "UTC"</span></code></pre></div>
<p><code>acc_running</code> consists of 300,000 observations of 5 variables:</p>
<ul>
<li>
<code>loc_id</code> - sensor location label, one of: <code>"left_hip"</code>, <code>"left_ankle"</code>,</li>
<li>
<code>date_time</code> - timestamp, stored as <code>POSIXct</code>,</li>
<li>
<code>x</code> - accelerometry time-series collected on the <span class="math inline">\(x\)</span>-axis of the sensor,</li>
<li>
<code>y</code> - accelerometry time-series collected on the <span class="math inline">\(y\)</span>-axis of the sensor,</li>
<li>
<code>x</code> - accelerometry time-series collected on the <span class="math inline">\(z\)</span>-axis of the sensor.</li>
</ul>
<div id="note-on-date_time-column-values" class="section level5">
<h5 class="hasAnchor">
<a href="#note-on-date_time-column-values" class="anchor" aria-hidden="true"></a>Note on <code>date_time</code> column values</h5>
<ul>
<li>Values in the <code>date_time</code> column were generated via <code>seq(from = as.POSIXct("2018-10-25 17:57:30.00", tz = "UTC"), by = 0.01, length.out = 150000)</code> and its display exhibits, likely, the floating point arithmetic problem (see this <a href="https://stackoverflow.com/questions/11571105/odd-behavor-with-posixct-posixlt-and-subsecond-accuracy" class="external-link">SO question</a>). Note <code>date_time</code> range is not affected and spans from <code>"2018-10-25 17:57:30.00 UTC"</code> to <code>"2018-10-25 18:22:29.99 UTC"</code>, inclusive.</li>
</ul>
</div>
</div>
</div>
<div id="accelerometry-data-visualization" class="section level1">
<h1 class="hasAnchor">
<a href="#accelerometry-data-visualization" class="anchor" aria-hidden="true"></a>Accelerometry data visualization</h1>
<div id="sub-second-level-accelerometry-data" class="section level3">
<h3 class="hasAnchor">
<a href="#sub-second-level-accelerometry-data" class="anchor" aria-hidden="true"></a>Sub-second level accelerometry data</h3>
<p>One way to visualize raw accelerometry data is to plot it as a three-dimensional time-series <span class="math inline">\((x,y,z)\)</span>. Here, we plot data from three different time frames, each of 4 seconds length, simultaneously for data collected at left ankle and left hip.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span>

<span class="co">## Define time frame start values for data subset</span>
<span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2018-10-25 18:07:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> 
<span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2018-10-25 18:20:30"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> 
<span class="va">t3</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2018-10-25 18:22:00"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span> 

<span class="co">## Mutate data: generate vector magnitude variable</span>
<span class="va">acc_running</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>vm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">z</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Subset data </span>
<span class="va">acc_running_sub</span> <span class="op">&lt;-</span> 
  <span class="va">acc_running</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">date_time</span> <span class="op">&gt;=</span> <span class="va">t1</span> <span class="op">&amp;</span> <span class="va">date_time</span> <span class="op">&lt;</span> <span class="va">t1</span> <span class="op">+</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/as.period.html" class="external-link">as.period</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> 
           <span class="op">(</span><span class="va">date_time</span> <span class="op">&gt;=</span> <span class="va">t2</span> <span class="op">&amp;</span> <span class="va">date_time</span> <span class="op">&lt;</span> <span class="va">t2</span> <span class="op">+</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/as.period.html" class="external-link">as.period</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> 
           <span class="op">(</span><span class="va">date_time</span> <span class="op">&gt;=</span> <span class="va">t3</span> <span class="op">&amp;</span> <span class="va">date_time</span> <span class="op">&lt;</span> <span class="va">t3</span> <span class="op">+</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/as.period.html" class="external-link">as.period</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>

<span class="co">## Plot (x,y,z) values </span>
<span class="va">acc_running_sub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">vm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span>id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date_time"</span>, <span class="st">"loc_id"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dt_floor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"time frame start: "</span>, 
                           <span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">date_time</span>, unit <span class="op">=</span> <span class="st">"minutes"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">loc_id</span> <span class="op">~</span> <span class="va">dt_floor</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time [s]"</span>, y <span class="op">=</span> <span class="st">"Acceleration [g]"</span>, color <span class="op">=</span> <span class="st">"Accelerometer axis of measurement: "</span>,
       title <span class="op">=</span> <span class="st">"Raw accelerometry data (x,y,z)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/plot_xyz-1.png" width="720"></p>
<div id="note-on-sensors-desynchronization" class="section level5">
<h5 class="hasAnchor">
<a href="#note-on-sensors-desynchronization" class="anchor" aria-hidden="true"></a>Note on sensors desynchronization</h5>
<ul>
<li>The two sensors used in the experiment were set up to initialize data collection at the same time. However, as discussed in<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>, perfect synchronization on most of modern operating systems is impossible. Additionally, measurements might still get desynchronized across devices even after a few minutes of data collection. Because of that, sub-second level alignment of data cross devices cannot be expected.</li>
</ul>
</div>
</div>
<div id="vector-magnitude" class="section level3">
<h3 class="hasAnchor">
<a href="#vector-magnitude" class="anchor" aria-hidden="true"></a>Vector magnitude</h3>
<p>Vector magnitude <span class="math inline">\((vm)\)</span> is often used to reduce the dimensionality of accelerometry time-series <span class="math inline">\((x,y,z)\)</span>. Vector magnitude is computed as <span class="math inline">\(vm = \sqrt{x^2 + y^2 + z^2}\)</span> at each time point resulting in 1- instead of 3-dimensional time-series.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot vector magnitude values </span>
<span class="va">acc_running_sub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dt_floor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
    <span class="st">"time frame start: "</span>,  <span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">date_time</span>, unit <span class="op">=</span> <span class="st">"minutes"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_time</span>, y <span class="op">=</span> <span class="va">vm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">loc_id</span> <span class="op">~</span> <span class="va">dt_floor</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time [s]"</span>, y <span class="op">=</span> <span class="st">"Vector magnitue [g]"</span>, 
       title <span class="op">=</span> <span class="st">"Vector magnitude (vm) summary of raw accelerometry data"</span><span class="op">)</span> </code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/plot_vm-1.png" width="720"></p>
<p>Plots of<span class="math inline">\((x,y,z)\)</span> and <span class="math inline">\((vm)\)</span> show an asymmetric repetitive pattern corresponding to walking strides:</p>
<ul>
<li>On the <span class="math inline">\((vm)\)</span> plot, the stride beginnings and ends can be identified by amplitude peaks corresponding to left foot heel-strikes; between these peaks, there are smaller peaks, corresponding to other stride-phases (toe-strikes, toe-offs of both feet and right foot heel-strike).</li>
</ul>
<p>There are also visible differences in amplitudes and stride durations across the three vertical plot panels:</p>
<ul>
<li><p>The left vertical plot panel (<code>time frame start: 2018-10-25 18:07:00</code>) corresponds to a slow/moderate pace running uphill; <span class="math inline">\((vm)\)</span> time-series is of a relatively high magnitude.</p></li>
<li><p>The middle vertical plot panel (<code>time frame start: 2018-10-25 18:20:00</code>) corresponds to a relatively fast running. We can observe high amplitude of <span class="math inline">\((vm)\)</span>, as well as shorter stride durations.</p></li>
<li><p>The right vertical plot panel (<code>time frame start: 2018-10-25 18:22:00</code>) corresponds to walking. We can observe a relatively low <span class="math inline">\((vm)\)</span> amplitude and longer stride durations.</p></li>
</ul>
</div>
<div id="vector-magnitude-count" class="section level3">
<h3 class="hasAnchor">
<a href="#vector-magnitude-count" class="anchor" aria-hidden="true"></a>Vector magnitude count</h3>
<p>In reality, it is often challenging to make a plot of <em>all</em> data points collected at sampling frequency of 100 Hz even in 25 minutes-long time-series. A one way to summarize accelerometry data of such high density is to use a <span class="math inline">\((vmc)\)</span> - vector magnitude count (also known as the mean amplitude deviation). For <span class="math inline">\(\overline{vm}(t,H)\)</span> - average of <span class="math inline">\((vm)\)</span> time-series over time window of length <span class="math inline">\(H\)</span> starting at time <span class="math inline">\(t\)</span>, we define <span class="math display">\[\mathrm { vmc } ( t, H ) = \frac { 1 } { H } \sum _ { h = 0 } ^ { H - 1 } \left| vm ( t + h ) - \overline{vm}(t,H) \right|.\]</span></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Function to compute vmc from a vm window vector</span>
<span class="va">vmc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vm.win</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">vm.win</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vm.win</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Compute vmc vector in 3-seconds windows </span>
<span class="va">vm</span> <span class="op">&lt;-</span> <span class="va">acc_running</span><span class="op">$</span><span class="va">vm</span>
<span class="va">win.vl</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">3</span>
<span class="va">rn.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vm</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">win.vl</span><span class="op">)</span>
<span class="va">vmc.vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">rn.seq</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rn.i</span><span class="op">)</span><span class="op">{</span>
  <span class="va">vm.win.idx</span> <span class="op">&lt;-</span> <span class="va">rn.i</span> <span class="op">:</span> <span class="op">(</span><span class="va">rn.i</span> <span class="op">+</span> <span class="va">win.vl</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">vm.win</span> <span class="op">&lt;-</span> <span class="va">vm</span><span class="op">[</span><span class="va">vm.win.idx</span><span class="op">]</span>
  <span class="fu">vmc</span><span class="op">(</span><span class="va">vm.win</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">vmc.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>vmc <span class="op">=</span> <span class="va">vmc.vec</span>,
                     date_time <span class="op">=</span> <span class="va">acc_running</span><span class="op">$</span><span class="va">date_time</span><span class="op">[</span><span class="va">rn.seq</span><span class="op">]</span>,
                     rn_seq <span class="op">=</span> <span class="va">rn.seq</span>,
                     loc_id <span class="op">=</span> <span class="va">acc_running</span><span class="op">$</span><span class="va">loc_id</span><span class="op">[</span><span class="va">rn.seq</span><span class="op">]</span><span class="op">)</span> 
<span class="va">vmc.df.rest</span> <span class="op">&lt;-</span> 
  <span class="va">vmc.df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">loc_id</span> <span class="op">==</span> <span class="st">"left_ankle"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>resting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">vmc</span> <span class="op">&lt;</span> <span class="fl">0.4</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
         vmc_tau_i <span class="op">=</span> <span class="va">rn_seq</span> <span class="op">-</span> <span class="fl">150000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date_time</span>, <span class="va">resting</span>, <span class="va">vmc_tau_i</span><span class="op">)</span>
<span class="va">vmc.df</span> <span class="op">&lt;-</span> <span class="va">vmc.df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">vmc.df.rest</span>, by <span class="op">=</span> <span class="st">"date_time"</span><span class="op">)</span>

<span class="co">## Plot vmc </span>
<span class="va">vmc.df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date_time</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_running</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span>, 
         <span class="va">date_time</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">acc_running</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_time</span>, y <span class="op">=</span> <span class="va">vmc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">loc_id</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">resting</span><span class="op">)</span><span class="op">)</span>,  height <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Exercise time [min]"</span>, y <span class="op">=</span> <span class="st">"Vector magnitue count"</span>,
       title <span class="op">=</span> <span class="st">"Vector magnitude count (vmc) computed over 3 second-length windows of (vm)"</span>,
       fill <span class="op">=</span> <span class="st">"Resting: "</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/plot_vmc-1.png" width="720"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Time percentage when (vmc) computed from left ankle is below 0.4</span>
<span class="op">(</span><span class="va">vmc.low.frac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vmc.df.rest</span><span class="op">$</span><span class="va">resting</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.186</span></code></pre></div>
<ul>
<li><p>We can see that approximately <span class="math inline">\(19\)</span>% of the time <span class="math inline">\((vmc)\)</span> computed from left ankle data is below <span class="math inline">\(0.4\)</span> value. Here, that part of data corresponds to standing with no walking/running legs movement involved. It is likely that the runner was i.e. waiting on the crossroad for a green light to cross. We use this arbitrarily selected threshold of <span class="math inline">\(0.4\)</span> to partition data into time frames of resting (<span class="math inline">\((vmc)&lt;0.4\)</span>; marked with light blue color) and non-resting (<span class="math inline">\((vmc)\geq 0.4\)</span>).</p></li>
<li><p>Analogously, high values of <span class="math inline">\((vmc)\)</span> correspond to high volumes of movement; in this experiment, at approx. 18:21 (6:21 PM) a short period of a fast run started, resulting in high values of <span class="math inline">\((vmc)\)</span> for both left ankle and left hip sensors.</p></li>
</ul>
</div>
</div>
<div id="walking-strides-segmentation" class="section level1">
<h1 class="hasAnchor">
<a href="#walking-strides-segmentation" class="anchor" aria-hidden="true"></a>Walking strides segmentation</h1>
<p>To segment strides from <span class="math inline">\((vm)\)</span> time-series, we use stride accelerometry data templates. These templates are specific to a wearable sensor location (i.e. left ankle-specific template). We demonstrate two approaches:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Approach 1</strong>: Use stride templates derived from accelerometry data collected in a different experiment, with different participants. These templates are attached to the <code>adeptdata</code> package as <code>stride_template</code> object; data used to derive them are also attached to the <code>adeptdata</code> package as <code>acc_walking_IU</code> (see <code><a href="https://rdrr.io/pkg/adeptdata/man/stride_template.html" class="external-link">?stride_template</a></code>, <code><a href="https://rdrr.io/pkg/adeptdata/man/acc_walking_IU.html" class="external-link">?acc_walking_IU</a></code> for details).</p></li>
<li><p><strong>Approach 2</strong>: Derive stride templates semi-manually from <code>acc_running</code> data set.</p></li>
</ol>
<div id="segmentation-with-approach-1-use-existing-stride-templates" class="section level3">
<h3 class="hasAnchor">
<a href="#segmentation-with-approach-1-use-existing-stride-templates" class="anchor" aria-hidden="true"></a>Segmentation with <em>Approach 1</em>: use existing stride templates</h3>
<div id="left-ankle" class="section level5">
<h5 class="hasAnchor">
<a href="#left-ankle" class="anchor" aria-hidden="true"></a>Left ankle</h5>
<p>We use pre-computed <code>stride_template {adeptdata}</code> to build a <code>template</code> object – a list of left ankle-specific stride templates.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">stride_template</span><span class="op">$</span><span class="va">left_ankle</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,
                 <span class="va">stride_template</span><span class="op">$</span><span class="va">left_ankle</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">template</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="st">"Left ankle: template 1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">template</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="st">"Left ankle: template 2"</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/segm_la-1.png" width="576"></p>
<p>We use <code>segmentPattern {adept}</code> function to segment strides from <span class="math inline">\((vm)\)</span> accelerometry time-series.</p>
<p>Explanation of function arguments used:</p>
<ul>
<li>
<code>x</code> - A time-series to segment pattern occurrences from (here: <span class="math inline">\((vm)\)</span> accelerometry time-series).</li>
<li>
<code>x.fs</code> - Data sampling frequency, expressed in a number of observations per second.</li>
<li>
<code>template</code> – Pattern template(s).</li>
<li>
<code>pattern.dur.seq</code> - A grid of potential stride durations, expressed in seconds.</li>
<li>
<code>similarity.measure</code> - Statistic used to quantify similarity between accelerometry time-series and template.</li>
<li>
<code>x.adept.ma.W</code> - Length of smoothing window used in accelerometry time-series processing before computing similarity between accelerometry time-series and templates, expressed in seconds.</li>
<li>
<code>finetune</code> - Procedure employed to fine-tune preliminarily identified beginnings and ends of a pattern in a accelerometry time-series.</li>
<li>
<code>finetune.maxima.ma.W</code> - Length of smoothing window used in <code>"maxima"</code> fine-tune procedure, expressed in seconds.</li>
<li>
<code>finetune.maxima.nbh.W</code> - Length of a local maxima search grid used in <code>"maxima"</code> fine-tune procedure, expressed in seconds.</li>
<li>
<code>compute.template.idx</code>- Whether or not to compute which of the (possibly multiple) templates best-matched accelerometry time-series.<br><code>run.parallel</code> - Whether or not to use parallel execution in the algorithm.</li>
</ul>
<p>See <code><a href="../reference/segmentPattern.html">?segmentPattern</a></code> for a detailed explanation of all parameters. See <a href="https://martakarass.github.io/adept/articles/adept-intro.html" class="external-link">Introduction to adept package</a> vignette for explanation of <code>segmentPattern {adept}</code> parameters with simulated data examples.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x.la</span> <span class="op">&lt;-</span> <span class="va">acc_running</span><span class="op">$</span><span class="va">vm</span><span class="op">[</span><span class="va">acc_running</span><span class="op">$</span><span class="va">loc_id</span> <span class="op">==</span> <span class="st">"left_ankle"</span><span class="op">]</span>
<span class="va">out1.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentPattern.html">segmentPattern</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">x.la</span>,
  x.fs <span class="op">=</span> <span class="fl">100</span>,
  template <span class="op">=</span> <span class="va">template</span>,
  pattern.dur.seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.8</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,
  similarity.measure <span class="op">=</span> <span class="st">"cor"</span>,
  x.adept.ma.W <span class="op">=</span> <span class="fl">0.15</span>,
  finetune <span class="op">=</span> <span class="st">"maxima"</span>,
  finetune.maxima.ma.W <span class="op">=</span> <span class="fl">0.05</span>,
  finetune.maxima.nbh.W <span class="op">=</span> <span class="fl">0.2</span>,
  compute.template.idx <span class="op">=</span> <span class="cn">TRUE</span>,
  run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out1.la</span><span class="op">)</span>
<span class="co">#&gt;   tau_i T_i     sim_i template_i</span>
<span class="co">#&gt; 1     1  65 0.3546074          1</span>
<span class="co">#&gt; 2    65  50 0.3143345          2</span>
<span class="co">#&gt; 3   133 124 0.7533280          1</span>
<span class="co">#&gt; 4   256  76 0.8841799          1</span>
<span class="co">#&gt; 5   371  81 0.9152038          1</span>
<span class="co">#&gt; 6   451  78 0.9075649          1</span></code></pre></div>
<p>The segmentation result is a data frame, where each row describes one identified pattern occurrence:</p>
<ul>
<li>
<code>tau_i</code> - index of <code>x</code> where pattern starts,</li>
<li>
<code>T_i</code> - pattern duration, expressed in <code>x</code> vector length,</li>
<li>
<code>sim_i</code> - similarity between a pattern and <code>x</code>,</li>
<li>
<code>template_i</code> - index of a pattern template best matched to a pattern in the time-series <code>x</code>.</li>
</ul>
</div>
<div id="left-hip" class="section level5">
<h5 class="hasAnchor">
<a href="#left-hip" class="anchor" aria-hidden="true"></a>Left hip</h5>
<p>We now segment strides from accelerometry data collected at left hip. We then compare the results with left ankle segmentation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">stride_template</span><span class="op">$</span><span class="va">left_hip</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,
                 <span class="va">stride_template</span><span class="op">$</span><span class="va">left_hip</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">template</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="st">"Left hip: template 1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">template</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, main <span class="op">=</span> <span class="st">"Left hip: template 2"</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/segm_lh-1.png" width="576"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">stride_template</span><span class="op">$</span><span class="va">left_hip</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,
                 <span class="va">stride_template</span><span class="op">$</span><span class="va">left_hip</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">x.lh</span> <span class="op">&lt;-</span> <span class="va">acc_running</span><span class="op">$</span><span class="va">vm</span><span class="op">[</span><span class="va">acc_running</span><span class="op">$</span><span class="va">loc_id</span> <span class="op">==</span> <span class="st">"left_hip"</span><span class="op">]</span>
<span class="va">out1.lh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentPattern.html">segmentPattern</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.lh</span>,
                          x.fs <span class="op">=</span> <span class="fl">100</span>,
                          template <span class="op">=</span> <span class="va">template</span>,
                          pattern.dur.seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.8</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,
                          similarity.measure <span class="op">=</span> <span class="st">"cor"</span>,
                          x.adept.ma.W <span class="op">=</span> <span class="fl">0.05</span>,
                          finetune <span class="op">=</span> <span class="st">"maxima"</span>,
                          finetune.maxima.ma.W <span class="op">=</span> <span class="fl">0.15</span>,
                          finetune.maxima.nbh.W <span class="op">=</span> <span class="fl">0.2</span>,
                          compute.template.idx <span class="op">=</span> <span class="cn">TRUE</span>,
                          run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out1.lh</span><span class="op">)</span>
<span class="co">#&gt;   tau_i T_i     sim_i template_i</span>
<span class="co">#&gt; 1     8  52 0.7124452          2</span>
<span class="co">#&gt; 2    59  54 0.8113169          2</span>
<span class="co">#&gt; 3   156 126 0.8446630          1</span>
<span class="co">#&gt; 4   301  70 0.6299608          1</span>
<span class="co">#&gt; 5   370  82 0.8684391          1</span>
<span class="co">#&gt; 6   451  79 0.8231402          1</span></code></pre></div>
</div>
<div id="results-estimated-stride-duration-time" class="section level4">
<h4 class="hasAnchor">
<a href="#results-estimated-stride-duration-time" class="anchor" aria-hidden="true"></a>Results: estimated stride duration time</h4>
<p>We estimate stride duration, expressed in seconds, as <code>T_i</code> divided by data sampling frequency (here: <span class="math inline">\(100\)</span>). Similarly, we estimate stride start, expressed in seconds after run-recording began, as <code>tau_i</code> divided by data sampling frequency; to get estimated stride start given in minutes after run-recording began, we additionally divide by <span class="math inline">\(60\)</span>.</p>
<p>We use previously derived information of resting (<span class="math inline">\((vmc)&lt;0.4\)</span>) and non-resting (<span class="math inline">\((vmc)\geq 0.4\)</span>) to filter out segmented data parts which likely do not correspond to running/walking. We then plot the estimated stride duration against estimated stride start. We use different background shade to mark the derived resting/non-resting labels for subsequent <span class="math inline">\(3\)</span>-minute windows.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Merge results from two sensor locations, add resting/non-resting info</span>
<span class="va">plt.df.la</span> <span class="op">&lt;-</span> 
  <span class="va">out1.la</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">vmc.df.rest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tau_i</span> <span class="op">&gt;=</span> <span class="va">vmc_tau_i</span>, <span class="va">tau_i</span> <span class="op">&lt;</span> <span class="va">vmc_tau_i</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">100</span>, <span class="va">resting</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"left_ankle"</span><span class="op">)</span>
<span class="va">plt.df.lh</span> <span class="op">&lt;-</span> 
  <span class="va">out1.lh</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">vmc.df.rest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tau_i</span> <span class="op">&gt;=</span> <span class="va">vmc_tau_i</span>, <span class="va">tau_i</span> <span class="op">&lt;</span> <span class="va">vmc_tau_i</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">100</span>, <span class="va">resting</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"left_hip"</span><span class="op">)</span>
<span class="va">plt.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">plt.df.la</span>, <span class="va">plt.df.lh</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plt.df</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tau_i</span> <span class="op">/</span> <span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span> , y <span class="op">=</span> <span class="va">T_i</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vmc.df.rest</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vmc_tau_i</span> <span class="op">/</span> <span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">resting</span><span class="op">)</span><span class="op">)</span>, 
            height <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">location</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Exercise time [min]"</span>, y <span class="op">=</span> <span class="st">"Estimated stride duration time [s]"</span>,
       fill <span class="op">=</span> <span class="st">"Resting: "</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<ul>
<li><p>We can see that the estimated stride duration (y-axis) is consistent between data collected at the left ankle and left hip. Some differences we observe may partially result from different smoothing parameters used in segmentation fine-tune procedure; left ankle data was smoothed less (<code>finetune.maxima.ma.W = 0.05</code>) than left hip data (<code>finetune.maxima.ma.W = 0.15</code>).</p></li>
<li><p>We may suppose that around the resting periods (light blue background), strides of both relatively long and short duration may correspond to the runner walking (making long slow steps, or very short steps). They can be a mislabeled resting data, too.</p></li>
</ul>
</div>
<div id="results-subject-specific-stride-pattern-left-ankle" class="section level4">
<h4 class="hasAnchor">
<a href="#results-subject-specific-stride-pattern-left-ankle" class="anchor" aria-hidden="true"></a>Results: subject-specific stride pattern (left ankle)</h4>
<p>We now use the estimated stride start (<code>tau_i</code>) and stride duration (<code>T_i</code>) to retrieve accelerometry <span class="math inline">\((vm)\)</span> time-series segments corresponding to segmented strides. We further align them in phase and scale to better observe stride patterns.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## For data frame #1 (raw vm segments)</span>
<span class="va">stride.acc.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">stride.tau_i.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">stride.idx.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## For data frame #2 (scaled vm segments)</span>
<span class="va">stride_S.acc.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">stride_S.tau_i.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">stride_S.phase.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">plt.df.la</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">out.i</span> <span class="op">&lt;-</span> <span class="va">plt.df.la</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>
  <span class="va">x.la.i</span> <span class="op">&lt;-</span> <span class="va">x.la</span><span class="op">[</span><span class="va">out.i</span><span class="op">$</span><span class="va">tau_i</span> <span class="op">:</span> <span class="op">(</span><span class="va">out.i</span><span class="op">$</span><span class="va">tau_i</span> <span class="op">+</span> <span class="va">out.i</span><span class="op">$</span><span class="va">T_i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span>
  <span class="va">x.la.i.len</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x.la.i</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x.la.i</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-3</span><span class="op">)</span> <span class="kw">next</span>
  <span class="co">## For data frame #1 </span>
  <span class="va">stride.acc.vec.la</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stride.acc.vec.la</span>, <span class="va">x.la.i</span><span class="op">)</span>
  <span class="va">stride.tau_i.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stride.tau_i.vec.la</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">out.i</span><span class="op">$</span><span class="va">tau_i</span>, <span class="va">x.la.i.len</span><span class="op">)</span><span class="op">)</span>
  <span class="va">stride.idx.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stride.idx.vec.la</span>, <span class="fl">1</span><span class="op">:</span><span class="va">x.la.i.len</span><span class="op">)</span>
  <span class="co">## For data frame #2</span>
  <span class="va">x.la.i_S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x.la.i</span><span class="op">)</span><span class="op">)</span>,
                     y <span class="op">=</span> <span class="va">x.la.i</span>,
                     xout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>
  <span class="va">x.la.i_S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x.la.i_S</span><span class="op">)</span><span class="op">)</span>
  <span class="va">stride_S.acc.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stride_S.acc.vec.la</span>, <span class="va">x.la.i_S</span><span class="op">)</span>
  <span class="va">stride_S.tau_i.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stride_S.tau_i.vec.la</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">out.i</span><span class="op">$</span><span class="va">tau_i</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>
  <span class="va">stride_S.phase.vec.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stride_S.phase.vec.la</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## data frame #1 </span>
<span class="va">stride.df.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>acc <span class="op">=</span> <span class="va">stride.acc.vec.la</span>, 
                           tau_i <span class="op">=</span> <span class="va">stride.tau_i.vec.la</span>,
                           idx <span class="op">=</span> <span class="va">stride.idx.vec.la</span><span class="op">)</span>
<span class="co">## data frame #2</span>
<span class="va">stride_S.df.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>acc <span class="op">=</span> <span class="va">stride_S.acc.vec.la</span>, 
                             tau_i <span class="op">=</span> <span class="va">stride_S.tau_i.vec.la</span>,
                             phase <span class="op">=</span> <span class="va">stride_S.phase.vec.la</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot segmented walking strides</span>
<span class="va">plt1</span> <span class="op">&lt;-</span> 
  <span class="va">stride.df.la</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">idx</span><span class="op">/</span><span class="fl">100</span>, y <span class="op">=</span> <span class="va">acc</span>, group <span class="op">=</span> <span class="va">tau_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Stride pattern duration [s]"</span>, y <span class="op">=</span> <span class="st">"Vector magnitude [g]"</span>,
       title <span class="op">=</span> <span class="st">"Segmented walking strides"</span><span class="op">)</span>
<span class="va">plt2</span> <span class="op">&lt;-</span> 
  <span class="va">stride_S.df.la</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">phase</span>, y <span class="op">=</span> <span class="va">acc</span>, group <span class="op">=</span> <span class="va">tau_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Stride pattern phase"</span>, y <span class="op">=</span> <span class="st">"Vector magnitude (scaled) [g]"</span>,
       title <span class="op">=</span> <span class="st">"Segmented walking strides, aligned and scaled"</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plt1</span>, <span class="va">plt2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/plot_subject_specific_sp-1.png" width="672"></p>
<ul>
<li>Based on the plot of aligned and scaled strides (right plot above), it seems there are at least two distinct stride patterns pronounced in data - one with a “spike with a dip” in a middle of a stride pattern phase, and another, less frequent (fewer lines on the plot), with a spike at approx. <span class="math inline">\(2/3\)</span> of a stride pattern phase.</li>
</ul>
<div id="correlation-clustering-of-segmented-walking-strides" class="section level5">
<h5 class="hasAnchor">
<a href="#correlation-clustering-of-segmented-walking-strides" class="anchor" aria-hidden="true"></a>Correlation clustering of segmented walking strides</h5>
<p>We can further use correlation clustering to group segmented walking strides.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Compute strides distance martrix</span>
<span class="va">stride_S.dfdc.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/cast.html" class="external-link">dcast</a></span><span class="op">(</span><span class="va">stride_S.df.la</span>, <span class="va">phase</span> <span class="op">~</span> <span class="va">tau_i</span>, value.var <span class="op">=</span> <span class="st">"acc"</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">data.mat.tau_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">stride_S.dfdc.la</span><span class="op">)</span><span class="op">)</span>
<span class="va">data.mat</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">stride_S.dfdc.la</span><span class="op">)</span>
<span class="va">D.mat</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">data.mat</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Get cluster medoids</span>
<span class="va">cluster.k</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">medoids.idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">stride_S.dfdc.la</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">cluster.k</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">medoids.idx</span> <span class="op">&lt;-</span> <span class="va">medoids.idx</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">medoids.idx</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span>

<span class="co">## Cluster strides</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">pam.out</span> <span class="op">&lt;-</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/pam.html" class="external-link">pam</a></span><span class="op">(</span><span class="va">D.mat</span>, <span class="va">cluster.k</span>, diss <span class="op">=</span> <span class="cn">TRUE</span>, medoids <span class="op">=</span> <span class="va">medoids.idx</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">pam.out</span><span class="op">$</span><span class="va">clustering</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    1    2 </span>
<span class="co">#&gt; 1420  120</span>

<span class="co">## Put clustering results into data frame </span>
<span class="va">data.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">data.mat</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data.df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, to <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>
<span class="va">data.df</span><span class="op">$</span><span class="va">tau_i</span> <span class="op">&lt;-</span> <span class="va">data.mat.tau_i</span>
<span class="va">data.df</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">pam.out</span><span class="op">$</span><span class="va">clustering</span>
<span class="va">data.dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">data.df</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tau_i"</span>, <span class="st">"cluster"</span><span class="op">)</span><span class="op">)</span>
<span class="va">data.dfm</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">data.dfm</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>
<span class="va">data.dfm</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cluster "</span>, <span class="va">data.dfm</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data.dfm.agg</span> <span class="op">&lt;-</span> 
  <span class="va">data.dfm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">cluster</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data.dfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">tau_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data.dfm.agg</span>,  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
            color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">cluster</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Stride pattern phase"</span>, y <span class="op">=</span> <span class="st">"Vector magnitude (scaled) [g]"</span>,
       title <span class="op">=</span> <span class="st">"Segmented walking strides, aligned, scaled, clustered\nRed line: point-wise mean"</span><span class="op">)</span> </code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/plot_correlation_clustering-1.png" width="384"></p>
<p>We further plot the estimated stride duration time over the course of the run-trial exercise. We mark the pattern cluster assignment with color.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data.dfm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">tau_i</span>, <span class="va">cluster</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">plt.df.la</span>, by <span class="op">=</span> <span class="st">"tau_i"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tau_i</span> <span class="op">/</span> <span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span> , y <span class="op">=</span> <span class="va">T_i</span> <span class="op">/</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vmc.df.rest</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vmc_tau_i</span> <span class="op">/</span> <span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">resting</span><span class="op">)</span><span class="op">)</span>, 
            height <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Exercise time [min]"</span>, y <span class="op">=</span> <span class="st">"Estimated stride duration time [s]"</span>,
       color <span class="op">=</span> <span class="st">"Stride assignment: "</span>,
       fill <span class="op">=</span> <span class="st">"Resting: "</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/correlation_clustering_2-1.png" width="672"></p>
<ul>
<li>From the plot above we can note that pattern cluster assignment corresponds to performed activity: strides marked with red <em>likely</em> correspond to running, strides marked with green - walking.</li>
</ul>
</div>
</div>
</div>
<div id="segmentation-with-approach-2-derive-stride-templates-semi-manually" class="section level3">
<h3 class="hasAnchor">
<a href="#segmentation-with-approach-2-derive-stride-templates-semi-manually" class="anchor" aria-hidden="true"></a>Segmentation with <em>Approach 2</em>: derive stride templates semi-manually</h3>
<p>We now demonstrate a semi-manual way of deriving stride patterns from scratch.</p>
<ol style="list-style-type: decimal">
<li><p>Smooth accelerometry <span class="math inline">\((vm)\)</span> time-series.</p></li>
<li><p>Select a short segment, or multiple segments, from the smoothed <span class="math inline">\((vm)\)</span> time-series.</p></li>
<li><p>Within each selected <span class="math inline">\((vm)\)</span> segment, use a function to automatically identify <em>all</em> local maxima.</p></li>
<li><p>Within each selected <span class="math inline">\((vm)\)</span> segment, identify a subset of local maxima that corresponds to stride beginnings and ends via visual inspection (the “manual” part).</p></li>
<li><p>For each selected <span class="math inline">\((vm)\)</span> segment, cut it at the points of identified local maxima subset from step 3., interpolate obtained parts to a common vector length, align, standardize to have mean 0 and variance 1, and compute their point-wise average. Standardize the average to have mean 0 and variance 1. For each <span class="math inline">\((vm)\)</span> segment, the resulted point-wise average is a one newly created template.</p></li>
</ol>
<p>Here, we select two <span class="math inline">\((vm)\)</span> fragments in step 1., each of 6 seconds length, in a way that they correspond to a different pace of running/walking. We apply the above procedure separately for data collected at the left hip and left ankle. That way, for each sensor location, we arrive at two distinct stride templates that we further use in segmentation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Function to compute local maxima</span>
<span class="co">## source: https://stackoverflow.com/questions/6836409/finding-local-maxima-and-minima</span>
<span class="va">localMaxima</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">.Machine</span><span class="op">$</span><span class="va">integer.max</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0L</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">$</span><span class="va">lengths</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fl">2L</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
  <span class="op">}</span>
  <span class="va">y</span>
<span class="op">}</span>

<span class="co">## Function which cut x vector at indices given by x.cut.idx,</span>
<span class="co">## approximate cut parts into common length and average </span>
<span class="co">## parts point-wise into one vector</span>
<span class="va">cut.and.avg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">x.cut.idx</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x.cut.idx.l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x.cut.idx</span><span class="op">)</span>
  <span class="va">mat.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">x.cut.idx.l</span><span class="op">-</span><span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x.cut.idx</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">xp</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x.cut.idx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">:</span><span class="va">x.cut.idx</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
    <span class="va">xpa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xp</span><span class="op">)</span><span class="op">)</span>, <span class="va">xp</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>
    <span class="va">mat.out</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">xpa</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mat.out</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">out</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Smooth the accelerometry vm time-series </span>
<span class="va">acc_running</span><span class="op">$</span><span class="va">vm_smoothed1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/windowSmooth.html">windowSmooth</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">acc_running</span><span class="op">$</span><span class="va">vm</span>, x.fs <span class="op">=</span> <span class="fl">100</span>, W <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="co">## Make subset of data which has data parts of different speed of running</span>
<span class="va">acc_running_sub2</span> <span class="op">&lt;-</span> 
  <span class="va">acc_running</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">date_time</span> <span class="op">&gt;=</span> <span class="va">t2</span> <span class="op">&amp;</span> <span class="va">date_time</span> <span class="op">&lt;</span> <span class="va">t2</span> <span class="op">+</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/as.period.html" class="external-link">as.period</a></span><span class="op">(</span><span class="fl">6</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> 
           <span class="op">(</span><span class="va">date_time</span> <span class="op">&gt;=</span> <span class="va">t3</span> <span class="op">&amp;</span> <span class="va">date_time</span> <span class="op">&lt;</span> <span class="va">t3</span> <span class="op">+</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/as.period.html" class="external-link">as.period</a></span><span class="op">(</span><span class="fl">6</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dt_floor <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">date_time</span>, unit <span class="op">=</span> <span class="st">"minutes"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Vector of signatures for data parts of different speed of running</span>
<span class="va">dt_floor.unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">acc_running_sub2</span><span class="op">$</span><span class="va">dt_floor</span><span class="op">)</span></code></pre></div>
<div id="deriving-stride-patterns-in-a-semi-manual-way-left-ankle" class="section level5">
<h5 class="hasAnchor">
<a href="#deriving-stride-patterns-in-a-semi-manual-way-left-ankle" class="anchor" aria-hidden="true"></a>Deriving stride patterns in a semi-manual way: left ankle</h5>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Left ankle-specific subset of data  </span>
<span class="va">sub.la</span> <span class="op">&lt;-</span> <span class="va">acc_running_sub2</span><span class="op">[</span><span class="va">acc_running_sub2</span><span class="op">$</span><span class="va">loc_id</span> <span class="op">==</span> <span class="st">"left_ankle"</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>

<span class="co">## Left ankle: template 1</span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">sub.la</span><span class="op">[</span><span class="va">sub.la</span><span class="op">$</span><span class="va">dt_floor</span> <span class="op">==</span> <span class="va">dt_floor.unique</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"vm_smoothed1"</span><span class="op">]</span>
<span class="va">x1.locMax</span> <span class="op">&lt;-</span> <span class="fu">localMaxima</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>, <span class="va">x1</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x1.locMax</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>, <span class="va">x1</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima subset"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x1.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span>, <span class="fl">13</span>, <span class="fl">16</span>, <span class="fl">19</span>, <span class="fl">23</span>, <span class="fl">26</span>, <span class="fl">29</span><span class="op">)</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="va">template.la.x1</span> <span class="op">&lt;-</span> <span class="fu">cut.and.avg</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x1.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span>, <span class="fl">13</span>, <span class="fl">16</span>, <span class="fl">19</span>, <span class="fl">23</span>, <span class="fl">26</span>, <span class="fl">29</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">template.la.x1</span><span class="op">)</span>, <span class="va">template.la.x1</span>, type <span class="op">=</span> <span class="st">"l"</span>, 
     col <span class="op">=</span> <span class="st">"red"</span>, main <span class="op">=</span> <span class="st">"left ankle: template 1"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/semi_manual_la-1.png" width="672"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## Left ankle: template 2</span>
<span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">sub.la</span><span class="op">[</span><span class="va">sub.la</span><span class="op">$</span><span class="va">dt_floor</span> <span class="op">==</span> <span class="va">dt_floor.unique</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"vm_smoothed1"</span><span class="op">]</span>
<span class="va">x2.locMax</span> <span class="op">&lt;-</span> <span class="fu">localMaxima</span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, <span class="va">x2</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x2.locMax</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, <span class="va">x2</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima subset"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x2.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">18</span>, <span class="fl">26</span>, <span class="fl">37</span>, <span class="fl">44</span><span class="op">)</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="va">template.la.x2</span> <span class="op">&lt;-</span> <span class="fu">cut.and.avg</span><span class="op">(</span><span class="va">x2</span>, <span class="va">x2.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">18</span>, <span class="fl">26</span>, <span class="fl">37</span>, <span class="fl">44</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">template.la.x2</span><span class="op">)</span>, <span class="va">template.la.x2</span>, type <span class="op">=</span> <span class="st">"l"</span>, 
     col <span class="op">=</span> <span class="st">"red"</span>, main <span class="op">=</span> <span class="st">"left ankle: template 2"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/semi_manual_la-2.png" width="672"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Template object</span>
<span class="va">template.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">template.la.x1</span>, <span class="va">template.la.x2</span><span class="op">)</span></code></pre></div>
</div>
<div id="deriving-stride-patterns-in-a-semi-manual-way-left-hip" class="section level5">
<h5 class="hasAnchor">
<a href="#deriving-stride-patterns-in-a-semi-manual-way-left-hip" class="anchor" aria-hidden="true"></a>Deriving stride patterns in a semi-manual way: left hip</h5>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Left hip-specific subset of data  </span>
<span class="va">sub.lh</span> <span class="op">&lt;-</span> <span class="va">acc_running_sub2</span><span class="op">[</span><span class="va">acc_running_sub2</span><span class="op">$</span><span class="va">loc_id</span> <span class="op">==</span> <span class="st">"left_hip"</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>

<span class="co">## Left hip: template 1 </span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">sub.lh</span><span class="op">[</span><span class="va">sub.lh</span><span class="op">$</span><span class="va">dt_floor</span> <span class="op">==</span> <span class="va">dt_floor.unique</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"vm_smoothed1"</span><span class="op">]</span>
<span class="va">x1.locMax</span> <span class="op">&lt;-</span> <span class="fu">localMaxima</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>, <span class="va">x1</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x1.locMax</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>, <span class="va">x1</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima subset"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x1.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">10</span>, <span class="fl">17</span>, <span class="fl">24</span>, <span class="fl">30</span>, <span class="fl">37</span>, <span class="fl">43</span>, <span class="fl">49</span>, <span class="fl">56</span><span class="op">)</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="va">template.lh.x1</span> <span class="op">&lt;-</span> <span class="fu">cut.and.avg</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x1.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">10</span>, <span class="fl">17</span>, <span class="fl">24</span>, <span class="fl">30</span>, <span class="fl">37</span>, <span class="fl">43</span>, <span class="fl">49</span>, <span class="fl">56</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">template.lh.x1</span><span class="op">)</span>, <span class="va">template.lh.x1</span>, type <span class="op">=</span> <span class="st">"l"</span>, 
     col <span class="op">=</span> <span class="st">"red"</span>, main <span class="op">=</span> <span class="st">"left ankle: template 1"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/semi_manual_lh-1.png" width="672"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## Left hip: template 2</span>
<span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">sub.lh</span><span class="op">[</span><span class="va">sub.lh</span><span class="op">$</span><span class="va">dt_floor</span> <span class="op">==</span> <span class="va">dt_floor.unique</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"vm_smoothed1"</span><span class="op">]</span>
<span class="va">x2.locMax</span> <span class="op">&lt;-</span> <span class="fu">localMaxima</span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, <span class="va">x2</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x2.locMax</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, <span class="va">x2</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"(vm) local maxima subset"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">x2.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">13</span>, <span class="fl">19</span>, <span class="fl">24</span>, <span class="fl">31</span><span class="op">)</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="va">template.lh.x2</span> <span class="op">&lt;-</span> <span class="fu">cut.and.avg</span><span class="op">(</span><span class="va">x2</span>, <span class="va">x2.locMax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">13</span>, <span class="fl">19</span>, <span class="fl">24</span>, <span class="fl">31</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">template.lh.x2</span><span class="op">)</span>, <span class="va">template.lh.x2</span>, type <span class="op">=</span> <span class="st">"l"</span>, 
     col <span class="op">=</span> <span class="st">"red"</span>, main <span class="op">=</span> <span class="st">"left ankle: template 2"</span>, xlab <span class="op">=</span> <span class="st">"Index"</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/semi_manual_lh-2.png" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Template object</span>
<span class="va">template.lh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">template.lh.x1</span>, <span class="va">template.lh.x2</span><span class="op">)</span></code></pre></div>
</div>
<div id="segmentation" class="section level5">
<h5 class="hasAnchor">
<a href="#segmentation" class="anchor" aria-hidden="true"></a>Segmentation</h5>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out2.la</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentPattern.html">segmentPattern</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.la</span>,
                          x.fs <span class="op">=</span> <span class="fl">100</span>,
                          template <span class="op">=</span> <span class="va">template.la</span>,
                          pattern.dur.seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.8</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,
                          similarity.measure <span class="op">=</span> <span class="st">"cor"</span>,
                          x.adept.ma.W <span class="op">=</span> <span class="fl">0.15</span>,
                          finetune <span class="op">=</span> <span class="st">"maxima"</span>,
                          finetune.maxima.ma.W <span class="op">=</span> <span class="fl">0.05</span>,
                          finetune.maxima.nbh.W <span class="op">=</span> <span class="fl">0.2</span>,
                          compute.template.idx <span class="op">=</span> <span class="cn">TRUE</span>,
                          run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">out2.lh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentPattern.html">segmentPattern</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.lh</span>,
                          x.fs <span class="op">=</span> <span class="fl">100</span>,
                          template <span class="op">=</span> <span class="va">template.lh</span>,
                          pattern.dur.seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.8</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,
                          similarity.measure <span class="op">=</span> <span class="st">"cor"</span>,
                          x.adept.ma.W <span class="op">=</span> <span class="fl">0.05</span>,
                          finetune <span class="op">=</span> <span class="st">"maxima"</span>,
                          finetune.maxima.ma.W <span class="op">=</span> <span class="fl">0.15</span>,
                          finetune.maxima.nbh.W <span class="op">=</span> <span class="fl">0.2</span>,
                          compute.template.idx <span class="op">=</span> <span class="cn">TRUE</span>,
                          run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="results-estimated-stride-duration-time-1" class="section level4">
<h4 class="hasAnchor">
<a href="#results-estimated-stride-duration-time-1" class="anchor" aria-hidden="true"></a>Results: estimated stride duration time</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Merge results from two sensor locations, add resting/non-resting info</span>
<span class="va">plt.df.la.2</span> <span class="op">&lt;-</span> 
  <span class="va">out2.la</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">vmc.df.rest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tau_i</span> <span class="op">&gt;=</span> <span class="va">vmc_tau_i</span>, <span class="va">tau_i</span> <span class="op">&lt;</span> <span class="va">vmc_tau_i</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">100</span>, <span class="va">resting</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"left_ankle"</span><span class="op">)</span>
<span class="va">plt.df.lh.2</span> <span class="op">&lt;-</span> 
  <span class="va">out2.lh</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">vmc.df.rest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tau_i</span> <span class="op">&gt;=</span> <span class="va">vmc_tau_i</span>, <span class="va">tau_i</span> <span class="op">&lt;</span> <span class="va">vmc_tau_i</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">100</span>, <span class="va">resting</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"left_hip"</span><span class="op">)</span>
<span class="va">plt.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">plt.df.la.2</span>, <span class="va">plt.df.lh.2</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plt.df</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tau_i</span> <span class="op">/</span> <span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span> , y <span class="op">=</span> <span class="va">T_i</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">vmc.df.rest</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vmc_tau_i</span> <span class="op">/</span> <span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">resting</span><span class="op">)</span><span class="op">)</span>, 
            height <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">location</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Exercise time [min]"</span>, y <span class="op">=</span> <span class="st">"Estimated stride duration time [s]"</span>,
       fill <span class="op">=</span> <span class="st">"Resting: "</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="adept-strides-segmentation_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<ul>
<li>From the plot above we see that the estimated stride duration times are fairly consistent between the two sensor locations, and also consistent with the estimates we obtained based on external, pre-computed stride templates.</li>
</ul>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor" aria-hidden="true"></a>References</h1>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Karas, M., Straczkiewicz, M., Fadel, W., Harezlak, J., Crainiceanu, C., Urbanek, J.K. <em>Adaptive empirical pattern transformation (ADEPT) with application to walking stride segmentation</em>, Submitted to <em>Biostatistics</em>, 2018.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Karas, M., Crainiceanu, C., Urbanek, J.: <em>Introduction to adept package</em> vignette to the ‘adept’ package.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Karas, M., Bai, J., Straczkiewicz, M., Harezlak, J., Glynn, N W., Harris, T., Zipunnikov, V., Crainiceanu, C., Urbanek, J.K. <em>Accelerometry data in health research: challenges and opportunities. Review and examples</em>, Statistics in Biosciences, 2018. (<a href="https://pubmed.ncbi.nlm.nih.gov/31762829/" class="external-link">link</a>).<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Marta Karas, Jacek Urbanek, Ciprian Crainiceanu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
